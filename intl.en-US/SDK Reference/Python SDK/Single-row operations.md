# Single-row operations

Tablestore SDKs provide the following single-row operations: PutRow, GetRow, UpdateRow, and DeleteRow.

## Prerequisites

-   The OTSClient instance is initialized. For more information, see [Initialization](/intl.en-US/SDK Reference/Python SDK/Initialization.md).
-   A data table is created. Data is written to the table.

## PutRow

You can call this operation to insert a row of data. If the row already exists, this operation deletes the existing row \(all columns and all versions of the original row\), and then writes data to the row.

-   API operations

    ```
            """
            Description: This operation writes a single row of data. Thu number of capacity unites (CUs) consumed by the operation is returned.
            table_name specifies the name of the table.
            row specifies the row you want to insert to the table, including a primary key and attribute columns.
            condition is an instance of the tablestore.metadata.Condition class. After you specify conditions, the system checks whether the specified conditions are met before the system performs the operation. If the conditions are met, the operation is performed. This function supports row existence and column-based condition checks. Check conditions for row existence include IGNORE, EXPECT_EXIST, and EXPECT_NOT_EXIST.
            return_type specifies the data type to return. return_type is an instance of the tablestore.metadata.ReturnType class. You can use only return_type to specify the type of primary key data to return. This parameter applies to auto-increment primary key columns.
    
            Response: the number of CUs consumed by this operation and the row data to return.
            consumed is an instance of the tablestore.metadata.CapacityUnit class. This parameter indicates the number of CUs consumed by this operation.
            return_row indicates the row to return, including the primary key and attribute columns.
            """
            def put_row(self, table_name, row, condition = None, return_type = None)
                        
    ```

-   Parameters

    |Parameter|Description|
    |---------|-----------|
    |table\_name|The name of the table.|
    |primary\_key|The primary key of the row.**Note:**

    -   The number and type of primary key columns configured must be consistent with those of primary key columns of the table.
    -   When the primary key column is an auto-increment column, you need only to set the value of the auto-increment column to placeholders. For more information, see [Configure an auto-increment primary key column](/intl.en-US/SDK Reference/Python SDK/Table operations/Configure an auto-increment primary key column.md). |
    |attribute\_columns|The attribute column of the row.    -   Each item specifies the values in the following sequence: the attribute column name, attribute column value \(ColumnValue\), attribute column value type \(ColumnType, which is optional\), and timestamp \(optional\).
    -   ColumnType can be set to ColumnType.INTEGER, ColumnType.STRING, ColumnType.BINARY, ColumnType.BOOLEAN, and ColumnType.DOUBLE, which respectively indicate the INTEGER, STRING \(UTF-8 encoded string\), BINARY, BOOLEAN, and DOUBLE types. If the type is BINARY, the type must be specified. Otherwise, the type can be ignored.
    -   The timestamp is the version number of the data. For more information, see [Max versions and TTL](/intl.en-US/Function Introduction/Wide Column model/Max versions and TTL.md).

You can customize a version number or specify that the system generates the version number. If the timestamp is not set, the version number is generated by the system.

        -   The version number is calculated based on the number of milliseconds that have elapsed since the epoch time January 1, 1970, 00:00:00 UTC.
        -   When you choose to customize the version number, make sure that the version number is a 64-bit timestamp accurate to the millisecond within the valid version range. |
    |condition|You can use conditional update to set row existence conditions or column-based conditions. For more information, see [Configure conditional update](/intl.en-US/SDK Reference/Python SDK/Table operations/Configure conditional update.md).**Note:**

    -   RowExistenceExpectation.IGNORE indicates that new data is inserted into a row no matter whether the specified row exists. If the specified row exists, the existing data is overwritten.
    -   RowExistenceExpectation.EXPECT\_EXIST indicates that new data is inserted only when the specified row exists. The existing data is overwritten.
    -   RowExistenceExpectation.EXPECT\_NOT\_EXIST indicates that data is inserted only when the specified row does not exist. |

-   Examples

    The following code provides an example on how to insert a row of data:

    **Note:** In the following example, the data version in the age attribute column is 1498184687000, which indicates June 23, 2017. If the current time minus max\_time\_deviation \(specified during table creation\) is greater than 1498184687000, PutRow is disabled.

    ```
        ## The first primary key column of the primary key is gid and its value is the integer 1. The second primary key column is uid and its value is the integer 101.
        primary_key = [('gid',1), ('uid',101)]
    
        ## Insert the following attribute columns:
        ##                        The name of the first attribute column is name and its value is the string John. The version number is not specified, so the current system time is used as the version number.
        ##                        The name of the second attribute column is mobile and its value is the integer 15100000000. The version number is not specified, so the current system time is used as the version number.
        ##                        The name of the third attribute column is address and its value is the binary string China. The version number is not specified, so the current system time is used as the version number.
        ##                        The name of the fourth attribute column is age and its value is 29.7. The version number is 1498184687000.
        attribute_columns = [('name','John'), ('mobile',15100000000),('address', bytearray('China')),('female', False), ('age', 29.7, 1498184687000)] 
    
        ## Construct a row by using primary_key and attribute_columns.
        row = Row(primary_key, attribute_columns)
    
        # Set the conditional update. The check condition for row existence is that the expected row does not exist. If the specified row exists, the Condition Update Failed error occurs.
        condition = Condition(RowExistenceExpectation.EXPECT_NOT_EXIST)
    
        try :
            # If ReturnType is not specified when you call the put_row method, the value of return_row is None.
            consumed, return_row = client.put_row(table_name, row, condition)
    
            # Display the write CUs consumed by this request.
            print ('put row succeed, consume %s write cu.' % consumed.write)
        # Client exceptions are caused by parameter errors or network exceptions.
        except OTSClientError as e:
            print "put row failed, http_status:%d, error_message:%s" % (e.get_http_status(), e.get_error_message())
        # Server exceptions are caused by parameter or throttling errors.
        except OTSServiceError as e:
            print "put row failed, http_status:%d, error_code:%s, error_message:%s, request_id:%s" % (e.get_http_status(), e.get_error_code(), e.get_error_message(), e.get_request_id())
                        
    ```

    For the detailed sample code, visit [PutRow@GitHub](https://github.com/aliyun/aliyun-tablestore-python-sdk/blob/master/examples/put_row.py).


## GetRow

You can call this operation to read a row of data.

The following results of the read request may be returned:

-   If the row exists, the primary key columns and attribute columns of the row are returned.
-   If the row does not exist, no row is returned and no error is reported.

-   API operations

    ```
           """
            Description: This operation reads a single row of data.
            table_name specifies the name of the table.
            primary_key specifies the primary key. Type: list.
            Optional. columns_to_get specifies the columns to read. If you do not specify this parameter, all columns are read. Type: list.
            Optional. column_filter specifies the filter conditions for columns. Only rows that meet the condition are returned.
            Optional. max_version specifies the maximum number of versions that can be read. You must specify at least one of max_version and time_range.
            Optional. time_range specifies a range of versions to read or a version of data to read. You must specify at least one of max_version and time_range.
    
            Response: the number of CUs consumed by this operation and the primary key columns and attribute columns.
            consumed is an instance of the tablestore.metadata.CapacityUnit class. This parameter indicates the number of CUs consumed by this operation.
            return_row indicates the row to return, including the primary key and attribute columns. Type: list. Example: [('PK0',value0), ('PK1',value1)].
            next_token indicates the start column of a wide row to read next time. The data type of the column is binary.
            """
            def get_row(self, table_name, primary_key, columns_to_get=None,
                    column_filter=None, max_version=None, time_range=None,
                    start_column=None, end_column=None, token=None):
                        
    ```

-   Parameters

    |Parameter|Description|
    |---------|-----------|
    |table\_name|The name of the table.|
    |primary\_key|The primary key of the row.**Note:** The number and type of primary key columns configured must be consistent with those of primary key columns of the table. |
    |columns\_to\_get|The set of columns to read. The column name can be the primary key column or attribute column. If you do not specify this parameter, all data in the row is returned.

**Note:**

    -   If you query a row of data, the system returns the data in all columns of the row. You can set the columns\_to\_get parameter to read the data only in specified columns. If col0 and col1 are added to columns\_to\_get, only the values of the col0 and col1 columns are returned.
    -   When columns\_to\_get and column\_filter are used at the same time, the columns specified by columns\_to\_get are returned. Then, the returned columns are filtered. |
    |max\_version|The maximum number of read versions.**Note:** You must specify at least one of max\_version and time\_range.

    -   If you specify only max\_version, data of up to the specified number of versions is returned from the latest to the earliest.
    -   If you specify only time\_range, all data within a range or a version of data is returned.
    -   If you specify both max\_version and time\_range, data of up to the specified number of versions within the time range is returned from the latest to the earliest. |
    |time\_range|Reads data within a range of versions or a version of data. For more information, see [TimeRange](/intl.en-US/API Reference/Data Types/TimeRange.md).**Note:** You must specify at least one of max\_version and time\_range.

    -   If you specify only max\_version, data of up to the specified number of versions is returned from the latest to the earliest.
    -   If you specify only time\_range, all data within a range or a version of data is returned.
    -   If you specify both max\_version and time\_range, data of up to the specified number of versions within the time range is returned from the latest to the earliest.
    -   To query data within a range, you must set start\_time and end\_time. start\_time specifies the start timestamp. end\_time indicates the end timestamp. The time range is a left-closed and right-open interval, which is \[start\_time, end\_time\).
    -   If you query data within a range of versions, set specific\_time. specific\_time specifies a specific timestamp.
You can set one of specific\_time and \[start\_time, end\_time\),

Valid values: \[0, INT64.MAX\). Unit: milliseconds. |
    |column\_filter|Filters the read results on the server side and returns only the rows of data that meet the conditions in the filter. For more information, see [Configure filter](/intl.en-US/SDK Reference/Python SDK/Table operations/Configure filter.md).**Note:** When columns\_to\_get and column\_filter are used at the same time, the columns specified by columns\_to\_get are returned. Then, the returned columns are filtered. |

-   Examples

    The following code provides an example on how to read a row of data:

    ```
        # The first primary key column is uid and its value is the integer 1. The second primary key column is gid and its value is the integer 101.
        primary_key = [('uid',1), ('gid',101)]
    
        # The attribute columns to return are name, growth, and type. If the value of columns_to_get is [], all attribute columns are returned.
        columns_to_get = ['name', 'growth', 'type'] 
    
        # Set filters for the columns. If the value in the growth column is not 0.9 and the value in the name column is Hangzhou, this row is returned.
        cond = CompositeColumnCondition(LogicalOperator.AND)
        cond.add_sub_condition(SingleColumnCondition("growth", 0.9, ComparatorType.NOT_EQUAL))
        cond.add_sub_condition(SingleColumnCondition("name", 'Hangzhou', ComparatorType.EQUAL))
    
        try:
            # If you set the value of the last parameter to 1 when you call the get_row operation, only a version of data is returned in the response.
            consumed, return_row, next_token = client.get_row(table_name, primary_key, columns_to_get, cond, 1)
            print ('Read succeed, consume %s read cu.' % consumed.read)
            print ('Value of primary key: %s' % return_row.primary_key)
            print ('Value of attribute: %s' % return_row.attribute_columns)
            for att in return_row.attribute_columns:
                # Display the key, value, and version of each column.
                print ('name:%s\tvalue:%s\ttimestamp:%d' % (att[0], att[1], att[2]))
        # Client exceptions are caused by parameter errors or network exceptions.
        except OTSClientError as e:
            print "get row failed, http_status:%d, error_message:%s" % (e.get_http_status(), e.get_error_message())
        # Server exceptions are caused by parameter or throttling errors.
        except OTSServiceError as e:
            print "get row failed, http_status:%d, error_code:%s, error_message:%s, request_id:%s" % (e.get_http_status(), e.get_error_code(), e.get_error_message(), e.get_request_id())
                        
    ```

    For the detailed sample code, visit [GetRow@GitHub](https://github.com/aliyun/aliyun-tablestore-python-sdk/blob/master/examples/get_row.py).


## UpdateRow

You can call this operation to update data of a specified row. You can add or delete attribute columns of a row, delete a specified version of data from an attribute column, or update the existing data in an attribute column. If the row does not exist, a new row is added.

**Note:** If the UpdateRow request contains only columns to delete, and the specified row does not exist, a new row is not added.

-   API operations

    ```
            """
            Description: This operation updates a single row of data.
            table_name specifies the name of the table.
            row specifies the row you want to delete, including a primary key and attribute columns of the list type.
            condition is an instance of the tablestore.metadata.Condition class. After you specify conditions, the system checks whether the specified conditions are met before the system performs the operation. If the conditions are met, the operation is performed. This function supports row existence and column-based condition checks. Check conditions for row existence include IGNORE, EXPECT_EXIST, and EXPECT_NOT_EXIST.
            return_type specifies the data type to return. return_type is an instance of the tablestore.metadata.ReturnType class. You can use only return_type to specify the type of primary key data to return. This parameter applies to auto-increment primary key columns.
            Response: the number of CUs consumed by this operation and the row data that is specified by return_row to return.
            consumed is an instance of the tablestore.metadata.CapacityUnit class. This parameter indicates the number of CUs consumed by this operation.
            return_row indicates the row to return.
            """
            def update_row(self, table_name, row, condition, return_type = None)
                        
    ```

-   Parameters

    |Parameter|Description|
    |---------|-----------|
    |table\_name|The name of the table.|
    |primary\_key|The primary key of the row.**Note:** The number and type of primary key columns configured must be consistent with those of primary key columns of the table. |
    |update\_of\_attribute\_columns|The attribute column to be updated.    -   To add or update data, you must set the attribute name, attribute value, attribute type \(optional\), and timestamp \(optional\).

You can customize a version number or specify that the system generates the version number. If the timestamp is not set, the version number is generated by the system. For more information, see [Max versions and TTL](/intl.en-US/Function Introduction/Wide Column model/Max versions and TTL.md).

        -   The version number is calculated based on the number of milliseconds that have elapsed since 00:00:00 UTC on January 1, 1970.
        -   When you choose to customize the version number, make sure that the version number is a 64-bit timestamp accurate to the millisecond within the valid version range.
    -   To delete a specific version of an attribute, you need only to set the attribute name and timestamp.

A timestamp is a 64-bit integer that indicates a specific version of data. Unit: milliseconds.

    -   When you delete an attribute column, you need only to set the attribute name.

**Note:** A row exists even if all attribute columns in the row are deleted. To delete a row, use the DeleteRow operation. |
    |condition|You can use conditional update to set row existence conditions or column-based conditions. For more information, see [Configure conditional update](/intl.en-US/SDK Reference/Python SDK/Table operations/Configure conditional update.md).|

-   Examples

    The following code provides an example on how to update the data of a specified row:

    ```
        # The first primary key column is uid and its value is the integer 1. The second primary key column is gid and its value is the integer 101.
        primary_key = [('uid',1), ('gid',101)]
    
        # The update types include PUT, DELETE, and DELETE_ALL.
        # PUT: adds a value to the column or updates the existing value in the column. In the example, two columns are added. The first column is name and its value is David. The second column is address and its value is Hongkong.
        # DELETE: deletes a specified version (timestamp) of data. In this example, data of the 1488436949003 version in the address column is deleted.
        # DELETE_ALL: deletes the column. In the example, the data of all versions in the mobile and age columns is deleted.
        update_of_attribute_columns = {
            'PUT' : [('name','David'), ('address','Hongkong')],
            'DELETE' : [('address', None, 1488436949003)],
            'DELETE_ALL' : [('mobile'), ('age')], 
        }
        row = Row(primary_key, update_of_attribute_columns)
    
        # The check condition for row existence is that the row existence is ignored. No matter whether the row exists, the row is updated.
        condition = Condition(RowExistenceExpectation.IGNORE, SingleColumnCondition("age", 20, ComparatorType.EQUAL)) # update row only when this row is exist
    
        try:
            consumed, return_row = client.update_row(table_name, row, condition)
        # Client exceptions are caused by parameter errors or network exceptions.
        except OTSClientError as e:
            print "update row failed, http_status:%d, error_message:%s" % (e.get_http_status(), e.get_error_message())
        # Server exceptions are caused by parameter or throttling errors.
        except OTSServiceError as e:
            print "update row failed, http_status:%d, error_code:%s, error_message:%s, request_id:%s" % (e.get_http_status(), e.get_error_code(), e.get_error_message(), e.get_request_id())
                        
    ```

    For the detailed sample code, visit [UpdateRow@GitHub](https://github.com/aliyun/aliyun-tablestore-python-sdk/blob/master/examples/update_row.py).


## DeleteRow

You can call this operation to delete a row of data. If the row to delete does not exist, no changes are made to the table.

-   API operations

    ```
            """
            Description: This operation deletes a single row of data.
            table_name specifies the name of the table.
            row specifies the row you want to delete, including only the primary key.
            condition is an instance of the tablestore.metadata.Condition class. After you specify conditions, the system checks whether the specified conditions are met before the system performs the operation. If the conditions are met, the operation is performed. This function supports row existence and column-based condition checks. Check conditions for row existence include IGNORE, EXPECT_EXIST, and EXPECT_NOT_EXIST.
            Response: the number of CUs consumed by this operation and the row data that is specified by return_row to return.
            consumed is an instance of the tablestore.metadata.CapacityUnit class. This parameter indicates the number of CUs consumed by this operation.
            return_row indicates the row to return.
            """
            def delete_row(self, table_name, row, condition, return_type = None): 
                        
    ```

-   Parameters

    |Parameter|Description|
    |---------|-----------|
    |table\_name|The name of the table.|
    |primary\_key|The primary key of the row.**Note:** The number and type of primary key columns configured must be consistent with those of primary key columns of the table. |
    |condition|You can use conditional update to set row existence conditions or column-based conditions. For more information, see [Configure conditional update](/intl.en-US/SDK Reference/Python SDK/Table operations/Configure conditional update.md).|

-   Examples

    The following code provides an example on how to delete a row of data:

    ```
        primary_key = [('gid',1), ('uid','101')]
        row = Row(primary_key)
        try:
            consumed, return_row = client.delete_row(table_name, row, None)
        # Client exceptions are caused by parameter errors or network exceptions.
        except OTSClientError as e:
            print "update row failed, http_status:%d, error_message:%s" % (e.get_http_status(), e.get_error_message())
        # Server exceptions are caused by parameter or throttling errors.
        except OTSServiceError as e:
            print "update row failed, http_status:%d, error_code:%s, error_message:%s, request_id:%s" % (e.get_http_status(), e.get_error_code(), e.get_error_message(), e.get_request_id())    
        print ('Delete succeed, consume %s write cu.' % consumed.write) 
                        
    ```

    For the detailed sample code, visit [DeleteRow@GitHub](https://github.com/aliyun/aliyun-tablestore-python-sdk/blob/master/examples/delete_row.py).


