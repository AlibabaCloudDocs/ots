# 数据版本和生命周期 {#concept_z5t_jmj_bfb .concept}

## 最大版本数 {#section_qsz_fyf_cfb .section}

最大版本数（Max Versions）是数据表的一个属性，表示该数据表中的属性列能够保留多少个版本的数据。当一个属性列的版本个数超过 Max Versions 时，最早的版本将被异步删除。

建表后，您可以通过 UpdateTable 接口动态更改数据表的 Max Versions。

**说明：** 

-   超过 Max Versions 的数据版本为无效数据，即使数据还没有被真正删除，该数据对用户已经不可见，无法读出。
-   当调小 Max Versions 时，如果数据版本个数超过新设的 Max Versions，最早的版本会被系统异步删除。
-   当调大 Max Versions 时，如果以前版本个数超过旧的 Max Versions 但还没有被系统删除的，数据会被重新读出来。

## 有效版本偏差 {#section_pnh_3yf_cfb .section}

有效版本偏差（Max Version Offset）是数据表的一个属性，单位为秒。

为了防止非期望的写入，服务端在处理写请求时会对属性列的版本号进行检查。当版本号小于当前写入时间减去 Max Version Offset，或者大于等于当前写入时间加上 Max Version Offset 的值时，该行数据写入失败。

属性列的有效版本范围为：\[数据写入时间 - 有效版本偏差，数据写入时间 + 有效版本偏差\)。数据写入时间为 1970-01-01 00:00:00 UTC 时间到当前写入时间的秒数。属性列版本号为毫秒，其除以 1000 换算成秒之后必须属于这个范围。

例如，当数据表的有效版本范围为 86400 （一天），在 2016-07-21 00:00:00 UTC 时，只能写入版本号大于 1468944000000 （换算成秒之后即 2016-07-20 00:00:00 UTC）并且小于 1469116800000 （换算成秒之后即 2016-07-22 00:00:00 UTC）的数据。当某一行的某个属性列版本号为 1468943999000 （换算成秒之后即 2016-07-19 23:59:59 UTC）时，该行数据写入失败。

-   建数据表时，用户若不设置有效版本偏差，将使用默认值 86400。

-   建表后，可以通过 UpdateTable 接口动态更改有效版本偏差。

-   有效版本偏差为非 0 值，可以大于 1970-01-01 00:00:00 UTC 时间到当前时间的秒数。


## 数据生命周期 {#section_cv2_kyf_cfb .section}

数据生命周期（Time To Live，简称 TTL）是数据表的一个属性，即数据的存活时间，单位为秒。表格存储会在后台对超过存活时间的数据进行清理，以减少用户的数据存储空间，降低存储成本。

-   TTL 由用户在建表时进行设置，如果希望数据永不过期，将其设置为 -1。

-   建表后，可以通过 UpdateTable 接口动态更改 TTL。

-   TTL 的单位为秒，例如期望过期时间为 30 天，TTL 应设置为 2592000（即 30 \* 24 \* 3600）。


假设数据表的 TTL 设置为 86400 （一天），在 2016-07-21 00:00:00 UTC 时，该数据表上所有版本号小于 1468944000000 （除以 1000 换算成秒之后即 2016-07-20 00:00:00 UTC）的属性列都将过期，系统会自动清理这些过期的数据。

**说明：** 

-   超过 TTL 的过期数据为无效数据，即使数据还没有被真正删除，该数据对用户已经不可见，无法读出。
-   当调小 TTL 时，可能会有数据因为 TTL 变小而过期，这部分数据会被系统异步删除。
-   当调大 TTL 时，如果有版本号在上个 TTL 之外的数据还没有被系统删除，数据会被重新读出。

